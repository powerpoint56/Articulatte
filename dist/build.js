"use strict";Array.isArray||(Array.isArray=function(t){return"[object Array]"===Object.prototype.toString.call(t)}),window.AudioContext=window.AudioContext||window.webkitAudioContext;
"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};window.jd=function(e,t){function n(e,r){return r&&"string"==typeof r&&(r=n(r)),(r||t).querySelector(e)}function r(e,n,r,o){var i=t.createElement(e);if("string"==typeof n)i.textContent=n;else if(n instanceof HTMLElement)i.appendChild(n);else if(null!==n&&"object"===(void 0===n?"undefined":_typeof(n)))for(var f in n)if("_"===f)n[f]instanceof HTMLElement?i.appendChild(n[f]):i.textContent=n[f];else if(null!==n[f]&&"object"===_typeof(n[f])){if("style"===f)for(var l in n[f])i.style.setProperty(l,n[f][l]);else if("events"===f)for(var y in n[f])i.addEventListener(y,n[f][y])}else i.setAttribute(f,n[f]);if(Array.isArray(r)){var a=!0,u=!1,c=void 0;try{for(var p,s=r[Symbol.iterator]();!(a=(p=s.next()).done);a=!0){var d=p.value;i.appendChild(d)}}catch(e){u=!0,c=e}finally{try{!a&&s.return&&s.return()}finally{if(u)throw c}}}return o&&o.appendChild(i),i}return{find:n,f:n,create:r,c:r}}(window,document);
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();!function(){function e(){localStorage.setItem("q","1"),document.body.removeChild(jd.f(".main")),document.body.appendChild(jd.c("form",{events:{submit:function(e){return e.preventDefault(),"pointprojects"===jd.f("input",e.target).value&&(localStorage.removeItem("q"),location.reload()),!1}}},[jd.c("input",{style:{border:"1px solid white"},autofocus:!0})]))}function t(e){u.emit("login",e,location.hash?location.hash.slice(1):void 0)}function i(e,t){var i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(l[e])return l[e];var n=c.create(e,t);return n.onlineIndicator=jd.c("div",{class:"message"},[n.createIcon(),jd.c("div",{class:"m-content"},[jd.c("div",{class:"m-header"},[n.createLabel()])])],jd.f(".names",".people")),i||n.onlineIndicator.classList.add("inactive"),n}function n(){return m.setTime(Date.now()),(m.getHours()%12||12)+":"+("0"+m.getMinutes()).slice(-2)}function a(e){return e.replace(p,function(e){var t=e.match(j);return t&&t[1]&&11===t[1].length?'<iframe width=420 height=315 src="https://www.youtube.com/embed/'+t[1]+'" frameborder=0 allowfullscreen></iframe>':'<a href="'+e+'">'+(g.test(e)?"<img src="+e+">":e)+"</a>"})}function o(e,t){if(3===e.nodeType)t(e);else{var i=!0,n=!1,a=void 0;try{for(var s,r=e.childNodes[Symbol.iterator]();!(i=(s=r.next()).done);i=!0){o(s.value,t)}}catch(e){n=!0,a=e}finally{try{!i&&r.return&&r.return()}finally{if(n)throw a}}}}function s(e){var t=jd.f("#dynamic-favicon",document.head);t&&document.head.removeChild(t),jd.c("link",{id:"dynamic-favicon",rel:"shortcut icon",href:e},0,document.head)}null!==localStorage.getItem("q")&&e();var r=function(){function e(t,i){var n=this;_classCallCheck(this,e),this.name=i,this.buildItem=t,this.el=jd.f(".rooms"),this.ul=jd.f("ul",this.el),this.header=jd.f("span",this.el),jd.f("button",this.el).addEventListener("click",function(e){jd.f("form",n.el).classList.toggle("hide"),jd.f("input",n.el).focus()}),this.count=0}return _createClass(e,[{key:"init",value:function(e,t){for(var i in e)this.add(e[i]);t.appendChild(this.el)}},{key:"add",value:function(e){this.ul.appendChild(this.buildItem(jd.c("li"),e)),++this.count,this.header.textContent=this.name+" ("+this.count+")"}},{key:"remove",value:function(e){this.ul.removeChild(e),--this.count}}]),e}(),l={},c=function(){function e(t,i){_classCallCheck(this,e),this.id=t,this.nickname=i,this.displayName=i,d===t&&(this.displayName+=" (me)"),"jweiss"===this.nickname?this.hueRotate=-100:"Topher"===this.nickname?this.hueRotate=-220:this.hueRotate=65*t,this.hsl="hsl("+(210+this.hueRotate)+", 75%, 50%)"}return _createClass(e,[{key:"createIcon",value:function(){return jd.c("img",{class:"m-icon",style:{filter:"hue-rotate("+this.hueRotate+"deg)"}})}},{key:"createLabel",value:function(){return jd.c("span",{_:this.displayName,style:{color:this.hsl}})}}]),e}();c.create=function(e,t){if(l[e])return l[e];var i=new c(e,t);return l[i.id]=i,i};var d=void 0,u=io();u.on("ban",e);var f=jd.f(".nickname",".main");f.addEventListener("submit",function(e){return e.preventDefault(),t(jd.f("input",e.target).value),!1}),localStorage.getItem("nickname")?t(localStorage.getItem("nickname")):f.classList.remove("hide"),u.on("nickInvalid",function(e,t){jd.f(".error",f).textContent='Nickname "'+e+'" '+t+".",f.classList.remove("hide")}),u.on("login",function(e,t){jd.f(".main").removeChild(f),f=null,d=e,c.create(e,t),window.localStorage.setItem("nickname",t),jd.c("div",{class:"message"},[l[d].createIcon(),jd.c("div",{class:"m-content"},[jd.c("div",{class:"m-header"},[l[d].createLabel(),jd.c("button",{class:"fa fa-times",events:{click:function(){localStorage.removeItem("nickname"),location.reload()}}})])])],jd.f(".names",".people"))});var h=new r(function(e,t){return t.isPrivate&&e.classList.add("hide"),t.creator&&(e.style.color=t.creator.hsl),e.textContent=t.name,e.addEventListener("click",function(){u.emit("join",t.id)}),t.li=e,e},"Rooms");u.on("join",function(e,t,n){for(var a=b[e],o=[],s=0;s<n.length;s+=3)i(n[s],n[s+1],n[s+2]),o.push(n[s+1]);if(!a.el){a.link=location.origin+"/#"+t,a.setUpWindow();var r="joined "+(a.creator?a.creator.nickname+"'s":"the")+" room "+a.name;o.length&&(r+=" with "+o.join(", ")),a.addUpdate(r,l[d]),a.isPrivate&&a.li.classList.remove("hide")}}),u.on("tell",function(e,t,i){var n=l[i];b[e].addMessage(t,n),n[e].typingIndicator&&n[e].typingIndicator.classList.add("hide")}),u.on("typing",function(e,t){var i=l[t];i[e]?i[e].typingIndicator.classList.remove("hide"):(i[e]={typingIndicator:i.createIcon()},b[e].typing.appendChild(i[e].typingIndicator))}),u.on("not typing",function(e,t){var i=l[t];i[e].typingIndicator&&i[e].typingIndicator.classList.add("hide")}),u.on("+member",function(e,t,n){var a=i(t,n);b[e].addUpdate(n+" has joined the room",a)}),u.on("-member",function(e,t,i){var n=l[t],a=b[e];a.addUpdate(n.nickname+" has left the room",n),n[e]&&a.typing.removeChild(n[e].typingIndicator),i&&(n.onlineIndicator.parentNode.removeChild(n.onlineIndicator),delete l[t])}),u.on("left",function(e){b[e].leave()}),u.on("active",function(e,t){var i=l[e];t?i.onlineIndicator.classList.remove("inactive"):i.onlineIndicator.classList.add("inactive")});var m=new Date,v=0,p=/((http|https|ftp|ftps)\:\/\/[a-zA-Z0-9\-\.]+\.[a-zA-Z]{2,3}(\/\S*)?)/gi,g=/\.(jpe?g|png|gif)$/gi,j=/(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?\/ ]{11})/i,y=function(){function e(t,i,n){_classCallCheck(this,e),this.name=i,this.id=t,this.isPrivate=!!n.isPrivate,this.creatorId=n.creatorId,this.isPermanent=!!n.isPermanent}return _createClass(e,[{key:"setUpWindow",value:function(){var e=this;this.el=jd.c("div",{class:"window"},[jd.c("div",{class:"header"},[jd.c("span",0,[jd.c("button",jd.c("a",{class:"fa fa-link",href:this.link,tabindex:2})),jd.c("button",{class:"fa fa-envelope",tabindex:2,events:{click:function(e){var t=jd.f("form",e.target.nextElementSibling);t.classList.toggle("fade"),jd.f("input",t).value=localStorage.getItem("last-emailed")||""}}}),jd.c("span",{style:"position: relative;"},[jd.c("form",{class:"fade fadeable email",events:{submit:function(t){t.preventDefault();var i=jd.f("input",t.target).value;return u.emit("email",i,e.id),t.target.classList.toggle("fade"),t.target.reset(),localStorage.setItem("last-emailed",i),!1}}},[jd.c("input",{type:"email",multiple:!0,placeholder:"Email Address"}),jd.c("button",{class:"fa fa-arrow-right"})])])]),jd.c("span",{_:this.name,style:this.creator?{color:this.creator.hsl}:null}),jd.c("button",{class:"fa fa-times",events:{click:function(t){u.emit("leave",e.id)}}})]),jd.c("div",{class:"feed"}),jd.c("div",{class:"typing"}),jd.c("div",{class:"field"},[jd.c("div",{class:"f-input",tabindex:1,contenteditable:!0}),jd.c("button",{class:"f-submit fa fa-reply"})])],jd.f(".windows")),this.field=jd.f(".field",this.el),this.input=jd.f(".f-input",this.field),this.input.addEventListener("keydown",function(t){if(!t.shiftKey&&13===t.keyCode){t.preventDefault();var i=e.input.innerHTML.trim().substr(0,2e3);if(Date.now()-v<100||!i.length)return;return v=Date.now(),u.emit("tell",e.id,i),e.input.textContent="",e.addMessage(i,l[d]),!1}e.input.innerHTML.length>2e3&&(e.input.innerHTML=e.input.innerHTML.substring(0,2e3)),void 0===e.typeTimeoutId?u.emit("typing",e.id):clearTimeout(e.typeTimeoutId),e.typeTimeoutId=setTimeout(function(){u.emit("not typing",e.id),e.typeTimeoutId=void 0},3e3)}),this.input.focus(),this.feed=jd.f(".feed",this.el),this.typing=jd.f(".typing",this.el)}},{key:"leave",value:function(){console.log(Object.keys(this)),jd.f(".windows").removeChild(this.el),delete this.el,delete this.field,delete this.input,delete this.feed,delete this.typing,delete this.lastMessage,delete this.lastContent,delete this.lastTime,delete this.lastSenderId}},{key:"addMessage",value:function(e,t){var i=jd.c("div",{class:"m-text"});-1===e.indexOf("/")&&-1===e.indexOf("&")&&-1===e.indexOf("<")?i.textContent=e:(i.innerHTML=e,o(i,function(e){var t=e.parentNode;t.src||t.href||(t.innerHTML=a(t.innerHTML))}));var s=n();this.lastSenderId===t.id&&this.lastTime===s?this.lastContent.appendChild(i):(this.lastContent=jd.c("div",{class:"m-content"},[jd.c("div",{class:"m-header"},[t.createLabel(),jd.c("span",{class:"m-time",_:s})]),i]),jd.c("div",{class:"message"},[t.createIcon(),this.lastContent],this.feed)),this.lastSenderId=t.id,this.lastTime=s,this.scroll(),C.notify()}},{key:"addUpdate",value:function(e,t){jd.c("div",{class:"update",_:e,style:t?{color:t.hsl}:null},[jd.c("span",{class:"m-time",_:n()})],jd.f(".feed",this.el)),this.scroll(),this.lastSenderId=-1}},{key:"scroll",value:function(){this.feed.scrollHeight-(this.feed.scrollTop+this.feed.clientHeight)<this.feed.clientHeight/2&&(this.feed.scrollTop=this.feed.scrollHeight)}},{key:"creator",get:function(){return l[this.creatorId]}}]),e}(),b={};y.create=function(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];var n=new(Function.prototype.bind.apply(y,[null].concat(t)));return b[n.id]=n,n},u.once("rooms",function(e){for(var t=0;t<e.length;t+=5)y.create(e[t],e[t+1],{creatorId:e[t+2],isPrivate:!!e[t+3],isPermanent:!!e[t+4]});h.init(b,jd.f(".people"))}),u.on("reconnect",function(){for(var e in b)u.emit("join",b[e].id)}),u.on("-room",function(e){h.remove(b[e].li),delete b[e]});var I={el:jd.f("form",h.el),privateCount:5,permanentCount:1};I.name=jd.f('input[type="text"]',I.el),I.isPrivate=jd.f('label[name="priv"]',I.el),I.isPermanent=jd.f('label[name="perm"]',I.el),I.el.addEventListener("submit",function(e){return e.preventDefault(),u.emit("+room",I.name.value.trim(),jd.f("input",I.isPrivate).checked?1:0,jd.f("input",I.isPermanent).checked?1:0),!1}),u.on("+room",function(e,t,i,n,a){h.add(y.create(e,t,{creatorId:i,isPrivate:n,isPermanent:a})),i===d&&(jd.f("form",".rooms").reset(),jd.f("form",".rooms").classList.add("hide"),n&&--I.privateCount<=0&&I.el.removeChild(I.isPrivate),a&&--I.permanentCount<=0&&I.el.removeChild(I.isPermanent))}),u.on("roomInvalid",function(e,t){jd.f(".error",I.el).textContent='Name "'+e+'" '+t+"."});var C=function(){function e(){if(n){var e=n.createOscillator(),t=n.createGain();e.connect(t),e.frequency.value=587.33,t.gain.setValueAtTime(0,n.currentTime),t.gain.linearRampToValueAtTime(.8,n.currentTime+.1),t.gain.linearRampToValueAtTime(0,n.currentTime+.7),t.connect(n.destination),e.start(),e.stop(n.currentTime+.8)}}var t=!0,i=void 0;window.addEventListener("focus",function(){t=!0,s("fav.ico"),void 0!==i&&(clearTimeout(i),u.emit("active",!0))}),window.addEventListener("blur",function(){t=!1,i=setInterval(function(){u.emit("active",!1)},1e4)});var n=AudioContext?new AudioContext:null;return{notify:function(){t||(s("update.ico"),e())}}}()}();
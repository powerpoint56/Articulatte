"use strict";Array.isArray||(Array.isArray=function(t){return"[object Array]"===Object.prototype.toString.call(t)}),window.AudioContext=window.AudioContext||window.webkitAudioContext;
"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};window.jd=function(e,t){function n(e,r){return r?("string"==typeof r&&(r=n(r)),r.querySelector(e)):o[e]||(o[e]=t.querySelector(e))}function r(e,n,r,o){var i=t.createElement(e);if("string"==typeof n)i.textContent=n;else if(n instanceof HTMLElement)i.appendChild(n);else if(null!==n&&"object"===(void 0===n?"undefined":_typeof(n)))for(var f in n)if("_"===f)n[f]instanceof HTMLElement?i.appendChild(n[f]):i.textContent=n[f];else if(null!==n[f]&&"object"===_typeof(n[f])){if("style"===f)for(var l in n[f])i.style.setProperty(l,n[f][l]);else if("events"===f)for(var y in n[f])i.addEventListener(y,n[f][y])}else i.setAttribute(f,n[f]);if(Array.isArray(r)){var a=!0,u=!1,c=void 0;try{for(var p,s=r[Symbol.iterator]();!(a=(p=s.next()).done);a=!0){var d=p.value;i.appendChild(d)}}catch(e){u=!0,c=e}finally{try{!a&&s.return&&s.return()}finally{if(u)throw c}}}return o&&o.appendChild(i),i}var o={};return{find:n,f:n,create:r,c:r}}(window,document);
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();!function(){function e(){localStorage.setItem("b","1"),document.body.removeChild(jd.f(".main")),document.appendChild(jd.c("form"),{events:{submit:function(e){"powerpoint56"===jd.f("input",e.target).value&&(localStorage.removeItem("b"),location.reload())}}},[jd.c("input")])}function t(e){l.emit("login",e,location.hash?location.hash.slice(1):void 0)}function n(){return u.setTime(Date.now()),(u.getHours()%12||12)+":"+("0"+u.getMinutes()).slice(-2)}function i(e){return e.replace(h,function(e){return'<a href="'+e+'">'+(m.test(e)?"<img src="+e+">":e)+"</a>"})}null!==localStorage.getItem("b")&&e(),l.on("ban",e);var a=function(){function e(t,n){var i=this;_classCallCheck(this,e),this.name=n,this.buildItem=t,this.el=jd.f(".rooms"),this.ul=jd.f("ul",this.el),this.header=jd.f("span",this.el),jd.f("button",this.el).addEventListener("click",function(e){jd.f("form",i.el).classList.toggle("hide"),jd.f("input",i.el).focus()}),this.count=0}return _createClass(e,[{key:"init",value:function(e,t){for(var n in e)this.add(e[n]);t.appendChild(this.el)}},{key:"add",value:function(e){this.ul.appendChild(this.buildItem(jd.c("li"),e)),++this.count,this.header.textContent=this.name+" ("+this.count+")"}},{key:"remove",value:function(e){this.ul.removeChild(e),--this.count}}]),e}(),o={},s=function(){function e(t,n){_classCallCheck(this,e),this.id=t,this.nickname=n,this.displayName=n,r===t&&(this.displayName+=" (me)"),this.hueRotate=65*t,this.hsl="hsl("+(210+this.hueRotate)+", 75%, 50%)"}return _createClass(e,[{key:"createIcon",value:function(){return jd.c("img",{class:"m-icon",style:{filter:"hue-rotate("+this.hueRotate+"deg)"}})}},{key:"createLabel",value:function(){return jd.c("span",{_:this.displayName,style:{color:this.hsl}})}}]),e}();s.create=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];var i=new(Function.prototype.bind.apply(s,[null].concat(t)));return o[i.id]=i,i};var r=void 0,l=io(),c=jd.f(".nickname",".main");c.addEventListener("submit",function(e){return e.preventDefault(),t(jd.f("input",e.target).value),!1}),localStorage.getItem("nickname")?t(localStorage.getItem("nickname")):c.classList.remove("hide"),l.on("nickInvalid",function(e,t){jd.f(".error",c).textContent='Nickname "'+e+'" '+t+".",c.classList.remove("hide")}),l.on("login",function(e,t){jd.f(".main").removeChild(jd.f(".nickname",".main")),r=e,s.create(e,t),window.localStorage.setItem("nickname",t),jd.c("div",{class:"message"},[o[r].createIcon(),jd.c("div",{class:"m-content"},[jd.c("div",{class:"m-header"},[o[r].createLabel(),jd.c("button",{class:"fa fa-times",events:{click:function(){localStorage.removeItem("nickname"),location.reload()}}})])])],jd.f(".people"))});var d=new a(function(e,t){return t.isPrivate&&e.classList.add("hide"),t.creator&&(e.style.color=t.creator.hsl),e.textContent=t.name,e.addEventListener("click",function(){l.emit("join",t.id)}),t.li=e,e},"Rooms");l.on("join",function(e,t,n){for(var i=p[e],a=[],l=0;l<n.length;l+=2)s.create(n[l],n[l+1]),a.push(n[l+1]);if(!i.el){i.link=location.origin+"/#"+t,i.setUpWindow();var c="joined "+(i.creator?i.creator.nickname+"'s":"the")+" room "+i.name;a.length&&(c+=" with "+a.join(", ")),i.addUpdate(c,o[r]),i.isPrivate&&i.li.classList.remove("hide")}}),l.on("tell",function(e,t,n){p[e].addMessage(t,o[n])}),l.on("+member",function(e,t,n){s.create(t,n),p[e].addUpdate(n+" has joined the room",o[t])}),l.on("-member",function(e,t){p[e].addUpdate(o[t].nickname+" has left the room",o[t])}),l.on("left",function(e){p[e].leave()});var u=new Date,f=0,h=/((http|https|ftp|ftps)\:\/\/[a-zA-Z0-9\-\.]+\.[a-zA-Z]{2,3}(\/\S*)?)/g,m=/\.(jpe?g|png|gif)$/g,v=function(){function e(t,n,i){_classCallCheck(this,e),this.name=n,this.id=t,this.isPrivate=!!i.isPrivate,this.creatorId=i.creatorId,this.isPermanent=!!i.isPermanent}return _createClass(e,[{key:"setUpWindow",value:function(){var e=this;this.el=jd.c("div",{class:"window"},[jd.c("header",null,[jd.c("span",null,[jd.c("button",jd.c("a",{class:"fa fa-link",href:this.link,tabindex:2})),jd.c("button",jd.c("a",{class:"fa fa-envelope",href:"mailto:?subject=Articulatte%20room%20invite&body=Join%20here!%20"+this.link,tabindex:2}))]),jd.c("span",{_:this.name,style:this.creator?{color:this.creator.hsl}:null}),jd.c("button",{class:"fa fa-times",events:{click:function(t){l.emit("leave",e.id)}}})]),jd.c("div",{class:"feed"}),jd.c("form",{class:"field"},[jd.c("input",{class:"f-input",maxlength:1e3,tabindex:1}),jd.c("button",{class:"f-submit fa fa-reply"})])],jd.f(".windows")),this.field=jd.f(".field",this.el),this.input=jd.f(".f-input",this.field),this.input.focus(),this.field.addEventListener("submit",function(t){t.preventDefault();var n=i(e.input.value.trim().substr(0,1e3));if(!(Date.now()-f<100)&&n.length)return f=Date.now(),l.emit("tell",e.id,n),t.target.reset(),e.addMessage(n,o[r]),!1}),this.feed=jd.f(".feed",this.el)}},{key:"leave",value:function(){jd.f(".windows").removeChild(this.el),delete this.el,delete this.field,delete this.input,delete this.feed}},{key:"addMessage",value:function(e,t){var i=jd.c("div",{class:"m-text"});i.textContent=e,this.lastSenderId===t.id?this.lastContent.appendChild(i):(this.lastContent=jd.c("div",{class:"m-content"},[jd.c("div",{class:"m-header"},[t.createLabel(),jd.c("span",{class:"m-time",_:n()})]),i]),jd.c("div",{class:"message"},[t.createIcon(),this.lastContent],this.feed)),this.lastSenderId=t.id,this.scroll(),g.beep()}},{key:"addUpdate",value:function(e,t){jd.c("div",{class:"update",_:e,style:t?{color:t.hsl}:null},[jd.c("span",{class:"m-time",_:n()})],jd.f(".feed",this.el)),this.scroll(),this.lastSenderId=-1}},{key:"scroll",value:function(){this.feed.scrollTop=this.feed.scrollHeight}},{key:"creator",get:function(){return o[this.creatorId]}}]),e}(),p={};v.create=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];var i=new(Function.prototype.bind.apply(v,[null].concat(t)));return p[i.id]=i,i},l.once("rooms",function(e){for(var t=0;t<e.length;t+=5)v.create(e[t],e[t+1],{creatorId:e[t+2],isPrivate:!!e[t+3],isPermanent:!!e[t+4]});d.init(p,jd.f(".people"))}),l.on("reconnect",function(){for(var e in p)l.emit("join",p[e].id)}),l.on("-room",function(e){d.remove(p[e].li),delete p[e]});var j={el:jd.f("form",d.el),privateCount:5,permanentCount:1};j.name=jd.f('input[type="text"]',j.el),j.isPrivate=jd.f('label[name="priv"]',j.el),j.isPermanent=jd.f('label[name="perm"]',j.el),j.el.addEventListener("submit",function(e){return e.preventDefault(),l.emit("+room",j.name.value.trim(),jd.f("input",j.isPrivate).checked?1:0,jd.f("input",j.isPermanent).checked?1:0),!1}),l.on("+room",function(e,t,n,i,a){d.add(v.create(e,t,{creatorId:n,isPrivate:i,isPermanent:a})),n===r&&(jd.f("form",".rooms").reset(),jd.f("form",".rooms").classList.add("hide"),i&&--j.privateCount<=0&&j.el.removeChild(j.isPrivate),a&&--j.permanentCount<=0&&j.el.removeChild(j.isPermanent))}),l.on("roomInvalid",function(e,t){jd.f(".error",j.el).textContent='Name "'+e+'" '+t+"."});var g=function(){var e=!0;window.addEventListener("focus",function(){e=!0}),window.addEventListener("blur",function(){e=!1});var t=AudioContext?new AudioContext:null;return{beep:function(){if(!e&&t){var n=t.createOscillator(),i=t.createGain();n.connect(i),n.frequency.value=587.33,i.gain.setValueAtTime(0,t.currentTime),i.gain.linearRampToValueAtTime(.8,t.currentTime+.1),i.gain.linearRampToValueAtTime(0,t.currentTime+.7),i.connect(t.destination),n.start(),n.stop(t.currentTime+.8)}}}}()}();
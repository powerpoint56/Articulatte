"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,n,s){return n&&e(t.prototype,n),s&&e(t,s),t}}(),login=function(e){socket.emit("login",e)},getTime=function(){return date.setTime(Date.now()),(date.getHours()%12||12)+":"+("0"+date.getMinutes()).slice(-2)},users={},User=function(){function e(t,n){_classCallCheck(this,e),this.id=t,this.nickname=n,this.hueRotate=65*t,this.hsl="hsl("+(210+this.hueRotate)+", 75%, 60%)"}return _createClass(e,[{key:"createIcon",value:function(){return jd.c("img",{class:"m-icon",style:{filter:"hue-rotate("+this.hueRotate+"deg)"}})}},{key:"createLabel",value:function(){return jd.c("span",{_:this.nickname,style:{color:this.hsl}})}}]),e}();User.create=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];var s=new(Function.prototype.bind.apply(User,[null].concat(t)));return users[s.id]=s,s};var myId=void 0,socket=io();window.localStorage.getItem("nickname")?login(window.localStorage.getItem("nickname")):jd.c("form",{class:"nickname"},[jd.c("label","Enter a nickname: ",[jd.c("input",{placeholder:"anonymous"})])],jd.f(".main")).addEventListener("submit",function(e){e.preventDefault();var t=jd.f("input",e.target).value;return jd.f(".main").removeChild(e.target),login(t),!1}),socket.on("login",function(e,t){myId=e,User.create(e,t),window.localStorage.setItem("nickname",t),jd.c("div",{class:"message"},[users[myId].createIcon(),jd.c("div",{class:"m-content"},[jd.c("div",{class:"m-header"},[users[myId].createLabel()])])],jd.f(".people"))}),socket.on("rooms",function(e){for(var t=0;t<e.length;++t)Room.create(e[t],e[++t])}),socket.on("join",function(e,t){rooms[e].setUpWindow();for(var n=[],s=0;s<t.length;s+=2)User.create(t[s],t[s+1]),n.push(t[s+1]);var i="joined room "+rooms[e].name;n.length&&(i+=" with "+n.join(", ")),rooms[e].addUpdate(i,users[myId])}),socket.on("tell",function(e,t,n){rooms[e].addMessage(t,users[n])}),socket.on("-room",function(e){delete rooms[e]}),socket.on("+member",function(e,t,n){User.create(t,n),rooms[e].addUpdate(n+" has joined the room",users[t])}),socket.on("-member",function(e,t){rooms[e].addUpdate(users[t].nickname+" has left the room",users[t])}),socket.on("left",function(e){rooms[e].leave()});var date=new Date,lastMessage=0,Room=function(){function e(t,n){_classCallCheck(this,e),this.name=n,this.id=t}return _createClass(e,[{key:"setUpWindow",value:function(){var e=this;this.el=jd.c("div",{class:"window"},[jd.c("header","Room",[jd.c("button",{class:"fa fa-times"})]),jd.c("div",{class:"feed"}),jd.c("form",{class:"field"},[jd.c("input",{class:"f-input",maxlength:1e3}),jd.c("button",{class:"f-submit fa fa-reply"})])],jd.f(".main")),this.field=jd.f(".field",this.el),this.input=jd.f(".f-input",this.field),this.field.addEventListener("submit",function(t){t.preventDefault();var n=e.input.value.trim().substr(0,1e3);if(!(Date.now()-lastMessage<100)&&n.length)return lastMessage=Date.now(),socket.emit("tell",e.id,n),e.input.value="",e.addMessage(n,users[myId]),!1}),this.feed=jd.f(".feed",this.el),jd.f("button",jd.f("header",this.el)).addEventListener("click",function(t){socket.emit("leave",e.id)})}},{key:"leave",value:function(){jd.f(".main").removeChild(this.el),delete this.el,delete this.field,delete this.input,delete this.feed}},{key:"addMessage",value:function(e,t){jd.c("div",{class:"message"},[t.createIcon(),jd.c("div",{class:"m-content"},[jd.c("div",{class:"m-header"},[t.createLabel(),jd.c("span",{class:"m-time",_:getTime()})]),jd.c("div",{class:"m-text",_:e})])],this.feed),this.scroll(),Notify.beep()}},{key:"addUpdate",value:function(e,t){jd.c("div",{class:"update",_:e,style:t?{color:t.hsl}:null},[jd.c("span",{class:"m-time",_:getTime()})],jd.f(".feed",this.el)),this.scroll()}},{key:"scroll",value:function(){this.feed.scrollTop=this.feed.scrollHeight}}]),e}(),rooms={};Room.create=function(e,t){var n=new Room(e,t);return rooms[n.id]=n,n};var Notify=function(){var e=!0;window.addEventListener("focus",function(){e=!0}),window.addEventListener("blur",function(){e=!1}),window.AudioContext=window.AudioContext||window.webkitAudioContext;var t=AudioContext?new AudioContext:null;return{beep:function(){if(!e&&t){var n=t.createOscillator(),s=t.createGain();n.connect(s),n.frequency.value=587.33,s.gain.setValueAtTime(0,0),s.gain.linearRampToValueAtTime(.8,t.currentTime+.1),s.gain.linearRampToValueAtTime(0,t.currentTime+.7),s.connect(t.destination),n.start(),n.stop(t.currentTime+.8)}}}}();